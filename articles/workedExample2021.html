<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Worked example - SOE 2021 â€¢ eofindices</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Worked example - SOE 2021">
<meta property="og:description" content="eofindices">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eofindices</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/eofindices.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/currentIndices.html">Current Indices</a>
    </li>
    <li>
      <a href="../articles/futureWork.html">Future Research</a>
    </li>
    <li>
      <a href="../articles/workedExample2020.html">Worked example - SOE 2020</a>
    </li>
    <li>
      <a href="../articles/workedExample2021.html">Worked example - SOE 2021</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="workedExample2021_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Worked example - SOE 2021</h1>
            
      
      
      <div class="hidden name"><code>workedExample2021.Rmd</code></div>

    </div>

    
    
<p>This worked example will result in the following figures (for a specified EPU):</p>
<ul>
<li>Primary Production Required index (scaled by Primary Production)</li>
<li>Fogarty Index (measure of ecosystem overfishing)</li>
<li>Ryther Index (measure of ecosystem overfishing)</li>
<li>Mean trophic level</li>
<li>Annual primary production</li>
<li>species composition over time</li>
</ul>
<p>The commercial landings data are confidential and are not bundled with this package. This example assumes you have access the the appropriate data base and have already pulled the data and stored it in a dataframe called <code>comland</code>. See package <a href="https://github.com/NOAA-EDAB/comlandr">`comlandr</a> for details.</p>
<p>Initial values for the following are needed:</p>
<ul>
<li>threshold - The proportion of landing explained by the species</li>
<li>transferEff - The transfer efficiency assumed for the PPR index. This is currently fixed for all species</li>
<li>epu - The region of interest (GOM, GB, MAB)</li>
</ul>
<p>The data are intially filtered by epu and the landings are aggregated by YEAR for each species (NESPP3 code). A grid is then create for all species in all years</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="va">threshold</span> <span class="op">&lt;-</span> <span class="st">"0.80"</span>
<span class="va">transferEff</span> <span class="op">&lt;-</span> <span class="fl">.15</span>
<span class="va">epu</span> <span class="op">&lt;-</span> <span class="st">"GOM"</span> 

<span class="co">## filter landings for designated EPU</span>
<span class="va">landings</span> <span class="op">&lt;-</span> <span class="va">comland</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">EPU</span> <span class="op">==</span> <span class="va">epu</span><span class="op">)</span>  <span class="op">%&gt;%</span> <span class="co"># US and NAFO landings</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">YEAR</span>,<span class="va">NESPP3</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>totLand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">SPPLIVMT</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">YEAR</span>,<span class="va">NESPP3</span><span class="op">)</span>

<span class="co"># list of unique species codes</span>
<span class="va">nespp3s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">comland</span><span class="op">$</span><span class="va">NESPP3</span><span class="op">)</span>
<span class="co"># expand grid (all species by all years) to include Zeros</span>
<span class="va">completeGrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>YEAR<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">comland</span><span class="op">$</span><span class="va">YEAR</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">comland</span><span class="op">$</span><span class="va">YEAR</span><span class="op">)</span>,NESPP3<span class="op">=</span><span class="va">nespp3s</span>,stringsAsFactors <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">landingsTable</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">completeGrid</span>,<span class="va">landings</span>,by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"YEAR"</span>,<span class="st">"NESPP3"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The scientific names for each species are obtained by cross referencing cfdbs and svdbs. Then rfishbase is accessed to pull the Trophic level data for each species</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get species itis, scientific name etc</span>
<span class="va">lookup</span> <span class="op">&lt;-</span> <span class="fu">dbutils</span><span class="fu">::</span><span class="fu">create_species_lookup</span><span class="op">(</span><span class="va">channel</span>,species<span class="op">=</span><span class="va">nespp3s</span><span class="op">)</span>
<span class="va">lookupTable</span> <span class="op">&lt;-</span> <span class="va">lookup</span><span class="op">$</span><span class="va">data</span>

<span class="co"># Select distinct species for fishbase ------------------------------------</span>
<span class="va">fishbaseTable</span> <span class="op">&lt;-</span> <span class="va">lookupTable</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">COMMON_NAME</span>,<span class="va">SCIENTIFIC_NAME</span>,<span class="va">NESPP3</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># access fishbase for Trophic level data</span>
<span class="va">callfishbase</span> <span class="op">&lt;-</span> <span class="fu">eofindices</span><span class="fu">::</span><span class="fu"><a href="../reference/get_trophic_level.html">get_trophic_level</a></span><span class="op">(</span><span class="va">fishbaseTable</span><span class="op">)</span>
<span class="va">fishbaseTable</span> <span class="op">&lt;-</span> <span class="va">callfishbase</span><span class="op">$</span><span class="va">fishbaseTable</span></code></pre></div>
<p>The indices are then calculated over the time range dictated by the landings data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">comland</span><span class="op">$</span><span class="va">YEAR</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">comland</span><span class="op">$</span><span class="va">YEAR</span><span class="op">)</span>

<span class="co"># Calculate the indices ---------------------------------------------------</span>
<span class="co"># preallocate</span>
<span class="va">PPR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">MTL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">iy</span> <span class="kw">in</span> <span class="va">yrs</span><span class="op">)</span> <span class="op">{</span> <span class="co">#loop</span>

  <span class="co"># filter out categories </span>
  <span class="va">annualLandings</span> <span class="op">&lt;-</span> <span class="va">landings</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">YEAR</span> <span class="op">==</span> <span class="va">iy</span>, <span class="op">!</span><span class="op">(</span><span class="va">NESPP3</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"526"</span>,<span class="st">"529"</span>,<span class="st">"817"</span>,<span class="st">"832"</span>,<span class="st">"806"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># OTHER FISH, ROCKWEED, SEAWEED, 806 = sea cucumbers</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">annualLandings</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span><span class="kw">next</span><span class="op">}</span>
  <span class="co"># pick species that make up top x % of landings</span>
  <span class="va">topSpecies</span> <span class="op">&lt;-</span> <span class="fu">eofindices</span><span class="fu">::</span><span class="fu"><a href="../reference/select_top_x_percent.html">select_top_x_percent</a></span><span class="op">(</span><span class="va">annualLandings</span><span class="op">$</span><span class="va">NESPP3</span>,<span class="va">annualLandings</span><span class="op">$</span><span class="va">totLand</span>,<span class="va">threshold</span><span class="op">)</span>
  <span class="va">nSpeciesTop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">topSpecies</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">nSpeciesTop</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"nSpecies"</span>
  <span class="va">topTable</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">topSpecies</span>,<span class="va">fishbaseTable</span>,by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NESPP3"</span><span class="op">)</span><span class="op">)</span>

  <span class="co"># set TL values for missing species. User defined function</span>
  <span class="va">topTable</span> <span class="op">&lt;-</span> <span class="fu">set_missingTL</span><span class="op">(</span><span class="va">topTable</span><span class="op">)</span>

  <span class="co"># filter the landings by year and species in top x% and aggregate</span>
  <span class="va">landingsTimeSeries</span> <span class="op">&lt;-</span> <span class="va">landingsTable</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">NESPP3</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">topTable</span><span class="op">$</span><span class="va">NESPP3</span><span class="op">)</span>,<span class="va">YEAR</span> <span class="op">==</span> <span class="va">iy</span><span class="op">)</span>
  <span class="co"># total landings for this set of species</span>
  <span class="va">landingsTop</span> <span class="op">&lt;-</span> <span class="va">landingsTimeSeries</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>landings<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">totLand</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># Calculate the PPR &amp; MTL indices------------------------------------------</span>
  <span class="co">### NOTE: We do not have discards in calculation, just landings</span>
  <span class="va">ppr_index</span> <span class="op">&lt;-</span> <span class="fu">eofindices</span><span class="fu">::</span><span class="fu"><a href="../reference/calc_ppr_index.html">calc_ppr_index</a></span><span class="op">(</span><span class="va">landingsTimeSeries</span>,<span class="va">topTable</span>,<span class="va">transferEff</span><span class="op">)</span>
  <span class="va">mtl_index</span> <span class="op">&lt;-</span> <span class="fu">eofindices</span><span class="fu">::</span><span class="fu"><a href="../reference/calc_mtl_index.html">calc_mtl_index</a></span><span class="op">(</span><span class="va">landingsTimeSeries</span>,<span class="va">topTable</span><span class="op">)</span>  
  <span class="co"># concatenate  </span>
  <span class="va">PPR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">PPR</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ppr_index</span>,<span class="va">nSpeciesTop</span>,<span class="va">landingsTop</span><span class="op">)</span><span class="op">)</span>  
  <span class="va">MTL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">MTL</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mtl_index</span>,<span class="va">nSpeciesTop</span>,<span class="va">landingsTop</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span> </code></pre></div>
<p>Primary production (PP) info is obtained and the PPR index is scaled by the annual PP to create an index representing proportion of PPR. The indices are shortened to the time frame represented by the PP data</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scaled</span> <span class="op">&lt;-</span> <span class="fu">eofindices</span><span class="fu">::</span><span class="fu">calc_PPR_scaled</span><span class="op">(</span><span class="va">PPR</span>,<span class="va">PP</span><span class="op">)</span>
<span class="va">MTL</span> <span class="op">&lt;-</span> <span class="va">MTL</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">YEAR</span> <span class="op">%in%</span> <span class="va">scaled</span><span class="op">$</span><span class="va">YEAR</span><span class="op">)</span></code></pre></div>
<p>The Fogarty and Ryther Indices are calculated</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fogarty_index</span> <span class="op">&lt;-</span> <span class="fu">eofindices</span><span class="fu">::</span><span class="fu"><a href="../reference/calc_fogarty_index.html">calc_fogarty_index</a></span><span class="op">(</span><span class="va">landings</span>,<span class="va">PP</span><span class="op">)</span>
<span class="va">ryther_index</span> <span class="op">&lt;-</span> <span class="fu">eofindices</span><span class="fu">::</span><span class="fu"><a href="../reference/calc_ryther_index.html">calc_ryther_index</a></span><span class="op">(</span><span class="va">landings</span>,area<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">comlandr</span><span class="fu">::</span><span class="va">EPUs</span><span class="op">[[</span><span class="va">epu</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">area</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The indices are then plotted</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">eofindices</span><span class="fu">::</span><span class="fu">plot_pp_index</span><span class="op">(</span><span class="va">scaled</span>,<span class="va">epu</span><span class="op">)</span>
<span class="fu">eofindices</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_ppr_index.html">plot_ppr_index</a></span><span class="op">(</span><span class="va">scaled</span>,<span class="va">epu</span><span class="op">)</span>
<span class="fu">eofindices</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_mtl_index.html">plot_mtl_index</a></span><span class="op">(</span><span class="va">MTL</span>,<span class="va">epu</span><span class="op">)</span>
<span class="fu">eofindices</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_fogarty_index.html">plot_fogarty_index</a></span><span class="op">(</span><span class="va">fogarty_index</span>,<span class="va">epu</span><span class="op">)</span>
<span class="fu">eofindices</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_ryther_index.html">plot_ryther_index</a></span><span class="op">(</span><span class="va">ryther_index</span>,<span class="va">epu</span><span class="op">)</span></code></pre></div>
<p><img src="figures/2021/PPR-GOM-0_80.png" width="50%"><img src="figures/2021/MTL-GOM-0_80.png" width="50%"><img src="figures/2021/PP-GOM.png" width="50%"><img src="figures/2021/fogarty-index-Constant-GOM.png" width="50%"><img src="figures/2021/ryther-index-GOM.png" width="50%"></p>
<div id="species-composition-over-time" class="section level2">
<h2 class="hasAnchor">
<a href="#species-composition-over-time" class="anchor"></a>Species composition over time</h2>
<p>This will also require a connection to internal oracle databases. A connection object should be created and passed as the variable <code>channel</code></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">## filter landings for designated EPU</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>landings &lt;-<span class="st"> </span>comland <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">filter</span>(EPU <span class="op">==</span><span class="st"> </span>epu)  <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># US and NAFO landings</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(YEAR,NESPP3) <span class="op">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarise</span>(<span class="dt">totLand =</span> <span class="kw">sum</span>(SPPLIVMT)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">arrange</span>(YEAR,NESPP3)</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a>  speciesComp &lt;-<span class="st"> </span>eofindices<span class="op">::</span><span class="kw">explore_species_composition</span>(channel,landings,<span class="kw">as.numeric</span>(threshold),<span class="dt">catchCN=</span><span class="st">"totLand"</span>)</span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="co"># hard code missing species names</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  ind &lt;-<span class="st"> </span>speciesComp<span class="op">$</span>data<span class="op">$</span>NESPP3 <span class="op">==</span><span class="st"> "524"</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  speciesComp<span class="op">$</span>data<span class="op">$</span>COMMON_NAME[ind] &lt;-<span class="st"> "OTHER GROUNDFISH"</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>  ind &lt;-<span class="st"> </span>speciesComp<span class="op">$</span>data<span class="op">$</span>NESPP3 <span class="op">==</span><span class="st"> "807"</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>  speciesComp<span class="op">$</span>data<span class="op">$</span>COMMON_NAME[ind] &lt;-<span class="st"> "SQUID,UNC"</span></span>
<span id="cb7-13"><a href="#cb7-13"></a></span>
<span id="cb7-14"><a href="#cb7-14"></a>  <span class="co"># aggregate all landings by YEAR  </span></span>
<span id="cb7-15"><a href="#cb7-15"></a>  yearAgg &lt;-<span class="st"> </span>speciesComp<span class="op">$</span>data <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(YEAR) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">summarize</span>(<span class="dt">totLand=</span><span class="kw">sum</span>(LANDINGS,<span class="dt">na.rm =</span> T))</span>
<span id="cb7-16"><a href="#cb7-16"></a>  </span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="er">}</span></span>
<span id="cb7-18"><a href="#cb7-18"></a></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="co"># Plot species composition</span></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="kw">plot</span>(speciesComp<span class="op">$</span>plotObj)</span></code></pre></div>
<p><img src="figures/2021/composition-GOM-0_80.png" width="80%"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Andy Beet, Michael Fogarty.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
