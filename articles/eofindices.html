<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction: eofindices • eofindices</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction: eofindices">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eofindices</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/eofindices.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/currentIndices.html">Current Indices</a>
    </li>
    <li>
      <a href="../articles/futureWork.html">Future Research</a>
    </li>
    <li>
      <a href="../articles/workedExample2020.html">Worked example - SOE 2020</a>
    </li>
    <li>
      <a href="../articles/workedExample2021.html">Worked example - SOE 2021</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction: eofindices</h1>
            
      

      <div class="hidden name"><code>eofindices.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">eofindices</span><span class="op">)</span></span></code></pre></div>
<p>A suite of tools used to calculate indices based on Trophic
level.</p>
<p>It is assumed that you already have your catch/landings data in a
data frame (<code>dataFrame</code>) with at least the following
fields:</p>
<ul>
<li>YEAR</li>
<li>SPECIES_CODE</li>
<li>CATCH</li>
<li>SCIENTIFIC_NAME</li>
</ul>
<p>If you are inside the NEFSC firewall then you do not need
SCIENTIFIC_NAME. There are functions in this package to obtain them if
your SPECIES_CODEs are one of the following NESPP3, SVSPP, or
SPECIES_ITIS.</p>
<div class="section level3">
<h3 id="scientific-names">Scientific names<a class="anchor" aria-label="anchor" href="#scientific-names"></a>
</h3>
<p>The scientific names are used to obtain trophic level information by
cross referencing information held in <code>fishbase</code> and
<code>sealifebase</code> by using the package <code>rfishbase</code></p>
<p>Note: Scientific names must be in the format: Genus species. eg.
Scomber scombrus. If the scientific names are all capitalized, they will
need to be converted to the required format.</p>
<p>You can use the <code>captialize_first_letter</code> function to
achieve this</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">eofindices</span><span class="fu">::</span><span class="fu"><a href="../reference/capitalize_first_letter.html">capitalize_first_letter</a></span><span class="op">(</span><span class="st">"SCOMBER SCOMBRUS"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Scomber scombrus"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="accessing-rfishbase">Accessing rfishbase<a class="anchor" aria-label="anchor" href="#accessing-rfishbase"></a>
</h3>
<p>Trophic level information is stored in <a href="http://fishbase.de" class="external-link">fishbase</a> and can be easily obtained using
the package <code>rfishbase</code>, part of the rOpenSci project - open
tools for open science. This is achievd using the function
<code><a href="../reference/get_trophic_level.html">eofindices::get_trophic_level</a></code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select distinct species from dataFrame</span></span>
<span><span class="va">speciesInfo</span> <span class="op">&lt;-</span> <span class="va">dataFrame</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">YEAR</span>,<span class="va">SPECIES_CODE</span>,<span class="va">SCIENTIFIC_NAME</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get trophic level information from rfishbase</span></span>
<span><span class="va">fishbaseTable</span> <span class="op">&lt;-</span> <span class="fu">eofindices</span><span class="fu">::</span><span class="fu"><a href="../reference/get_trophic_level.html">get_trophic_level</a></span><span class="op">(</span><span class="va">speciesInfo</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now join the trophic level info with your dataFrame</span></span>
<span><span class="va">newDataFrame</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dataFrame</span>,<span class="va">fishbaseTable</span>,by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NESPP3"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The data is now in the correct format to calulate the two indices;
Primary Production Required and Mean Trophic Level.</p>
</div>
<div class="section level3">
<h3 id="indices">Indices<a class="anchor" aria-label="anchor" href="#indices"></a>
</h3>
<div class="section level4">
<h4 id="primary-production-required-ppr">Primary Production Required (PPR)<a class="anchor" aria-label="anchor" href="#primary-production-required-ppr"></a>
</h4>
<p>The index is a measure of the impact of fishing on the base of the
foodweb. The amount of potential yield we can expect from a marine
ecosystem depends on the amount of production entering at the base of
the food web, primarily in the form of phytoplankton; the pathways this
energy follows to reach harvested species; the efficiency of transfer of
energy at each step in the food web; and the fraction of this production
that is removed by the fisheries. Species such as scallops and clams
primarily feed directly on larger phytoplankton species and therefore
require only one step in the transfer of energy. The loss of energy at
each step can exceed 80-90%. For many fish species, as many as 2-4 steps
may be necessary. Given the trophic level and the efficiency of energy
transfer of the species in the ecosystem the amount phytoplankton
production required (PPR) to account for the observed catch can be
estimated.</p>
<p>The index for Primary Production Required (PPR) was adapted from
<span class="citation">[@pauly1995ppr]</span>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>t</mi></msub></munderover><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>l</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi><msub><mi>s</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub></mrow><mn>9</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mn>1</mn><mrow><mi>T</mi><mi>E</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>T</mi><msub><mi>L</mi><mi>i</mi></msub><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">PPR_t = \sum_{i=1}^{n_t}  \left(\frac{landings_{t,i}}{9}\right) \left(\frac{1}{TE}\right)^{TL_i-1}</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>t</mi></msub><annotation encoding="application/x-tex">n_t</annotation></semantics></math>
= number of species in time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi><msub><mi>s</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">landings_{t,i}</annotation></semantics></math>
= landings of species
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
in time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><msub><mi>L</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">TL_i</annotation></semantics></math>
is the trophic level of species
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">TE</annotation></semantics></math>
= Trophic efficiency. The PPR estimate assumes a 9:1 ratio for the
conversion of wet weight to carbon and a 15% transfer efficiency per
trophic level,
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">TE</annotation></semantics></math>
= 0.15)</p>
</div>
<div class="section level4">
<h4 id="mean-trophic-level">Mean Trophic Level<a class="anchor" aria-label="anchor" href="#mean-trophic-level"></a>
</h4>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mrow><mi>T</mi><mi>L</mi></mrow><mo accent="true">̂</mo></mover><mi>t</mi></msub><mo>=</mo><mfrac><mrow><msub><mi>Σ</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>l</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi><msub><mi>s</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><mi>T</mi><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>Σ</mi><mi>i</mi></msub><mi>l</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi><msub><mi>s</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex"> \hat{TL}_t = \frac{\Sigma_{i} (landings_{t,i}  TL_{i})}{\Sigma_{i} landings_{t,i}}</annotation></semantics></math></p>
<p>Use the two functions</p>
<ul>
<li><code>calc_ppr_index</code></li>
<li><code>calc_mtl_index</code></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># To calculate the PPR index</span></span>
<span><span class="va">ppr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_ppr_index.html">calc_ppr_index</a></span><span class="op">(</span><span class="va">newDataFrame</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To calculate the mean trophic level</span></span>
<span><span class="va">mtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_mtl_index.html">calc_mtl_index</a></span><span class="op">(</span><span class="va">newDataFrame</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="additional-tools">Additional tools<a class="anchor" aria-label="anchor" href="#additional-tools"></a>
</h3>
<p>If you are inside the NEFSC firewall then you can use the NESPP3,
SVSPP, or SPECIES_ITIS codes to obtain the SCIENTIFIC_NAMES (in addition
to other variables). To do this you’ll need a connection several
things:</p>
<ul>
<li>Oracle username and password</li>
<li>Oracle client installed on your machine</li>
<li>A databse connection object
<code>dbutils::connect_to_database</code>
</li>
<li>Run <code>dbutils::create_species_lookup</code>
</li>
</ul>
<p><code>dbutils</code> is a dependency of this package so you should
have it installed already</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andy Beet, Michael Fogarty.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
